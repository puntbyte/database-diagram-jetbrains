<!-- web/index.html -->
<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8"/>
    <link rel="icon" type="image/svg+xml" href="./vite.svg"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>web</title>
  <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();class un{onMessage;constructor(e){this.onMessage=e,window.addEventListener("message",t=>{const n=t.data;n&&typeof n.type=="string"&&this.onMessage(n)}),this.send({type:"READY"})}send(e){const t=JSON.stringify(e);window.cefQuery?window.cefQuery({request:t}):console.log("Bridge Dev Log:",e)}log(e){this.send({type:"LOG",level:"INFO",message:e})}}function De(d){return d.replace(/[^a-zA-Z0-9_]/g,"_")}function dn(d){return d.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"")}function Fe(d){const e=new Map;if(!d)return e;const t=d.split(",").map(n=>n.trim()).filter(Boolean);for(let n of t)if(n.includes(":")){const[r,...a]=n.split(":");e.set(r.trim().toLowerCase(),a.join(":").trim())}else e.set(n.toLowerCase(),"true");return e}function fn(d){const e={},n=/Project\s*(?:(?:"[^"]*")|(?:[\w]+))?\s*\{([\s\S]*?)\}/i.exec(d);return n&&n[1].split(`
`).forEach(o=>{const y=o.split(":");if(y.length>=2){const s=y[0].trim();let m=y.slice(1).join(":").trim();(m.startsWith("'")&&m.endsWith("'")||m.startsWith('"')&&m.endsWith('"'))&&(m=m.substring(1,m.length-1)),!isNaN(Number(m))&&m!==""?e[s]=Number(m):e[s]=m}}),e}function gt(d){const e=[],t=d.split(`
`).map(n=>n.trim()).filter(Boolean);for(let n of t){const r=/^(\(?\s*[\w\.,\s]+\s*\)?)(?:\s*\[(.*?)\])?$/i.exec(n);if(!r)continue;const a=r[1].replace(/^\(/,"").replace(/\)$/,"").split(",").map(y=>y.trim()).filter(Boolean),o=Fe(r[2]||"");e.push({columns:a,settings:Object.fromEntries(o),raw:n})}return e}function $t(d,e,t){const n=t.split(",").map(b=>b.trim());let r=!1,a=!1,o=!1,y=!1,s,m,f,p;for(const b of n){/pk|primary key/i.test(b)&&(r=!0),/unique/i.test(b)&&(a=!0),/not null/i.test(b)&&(o=!0);const N=/note:\s*(['"])([\s\S]*?)\1/i.exec(b);N&&(s=N[2]);const T=/default:\s*(['`])?([\s\S]*?)\1?/i.exec(b);T&&(m=T[2]);const h=/ref:\s*(<>|[<>=-])\s*("?[\w.]+"?)\.("?[\w"]+"?)/i.exec(b);h&&(y=!0,p={symbol:h[1],toTable:h[2],toColumn:h[3]})}return{name:d,type:e,isPk:r,isUnique:a,isNotNull:o,isFk:y,note:s,default:m,enumValues:f,inlineRef:p}}function hn(d){const e=[],t=d.split(`
`);for(let n of t){if(n=n.trim(),!n||n.startsWith("Note"))continue;const a=/^("?[\w]+"?)\s+([a-zA-Z0-9_()]+)(?:\s*\[(.*?)\])?/.exec(n);a&&e.push($t(a[1].replace(/"/g,""),a[2],a[3]||""))}return{fields:e}}function Bt(d,e,t,n,r){const a=y=>y.replace(/"/g,"");let o="1:n";return t==="<"?o="1:n":t===">"?o="n:1":t==="-"?o="1:1":t==="<>"&&(o="m:n"),{fromTable:De(a(d)),fromColumn:a(e),toTable:De(a(n)),toColumn:a(r),type:o}}function mn(d){const e=[],t=/("?[\w.]+"?)\.("?[\w"]+"?)\s*(<>|[<>=-])\s*("?[\w.]+"?)\.("?[\w"]+"?)/g,n=/Ref\s*[^{:]*[:\{]\s*([^}]+)\s*\}?/gi;let r;for(;(r=n.exec(d))!==null;){const a=r[1];let o;for(;(o=t.exec(a))!==null;)e.push(Bt(o[1],o[2],o[3],o[4],o[5]))}return e}function pn(d){const e=[],t=[],n=new Map,r=/TablePartial\s+("?[\w.]+"?)\s*(?:\[(.*?)\])?\s*\{([\s\S]*?)\}/gi;let a;for(;(a=r.exec(d))!==null;){const s=a[1].replace(/"/g,""),m=a[2]||"",f=a[3]||"",p=/indexes\s*\{([\s\S]*?)\}/i.exec(f);let b=[],N=f;p&&(b=gt(p[1]),N=f.replace(p[0],""));const{fields:T}=hn(N);n.set(s,{name:s,settings:Fe(m),fields:T,indexes:b})}const o=/Table\s+("?[\w.]+"?)\s*(?:\[(.*?)\])?\s*(?:as\s+\w+\s*)?\{([\s\S]*?)\}/gi;let y;for(;(y=o.exec(d))!==null;){const s=y[1].replace(/"/g,""),m=y[2]||"",f=y[3]||"",p=Fe(m),b=/indexes\s*\{([\s\S]*?)\}/i.exec(f);let N=[],T=f;b&&(N=gt(b[1]),T=f.replace(b[0],""));const h=T.split(`
`),c=new Map,w=[],O=new Map,A=new Map;for(let $ of h){const S=$.trim();if(!S)continue;if(S.startsWith("~")){const L=S.replace(/^~\s*/,"").trim(),C=n.get(L);if(C){for(const[M,v]of C.settings.entries())A.set(M,v);for(const M of C.fields){if(c.has(M.name)){const v=w.indexOf(M.name);v!==-1&&w.splice(v,1)}c.set(M.name,M),w.push(M.name)}for(const M of C.indexes)O.set(M.columns.join("|").toLowerCase(),M)}continue}const E=/^("?[\w]+"?)\s+([a-zA-Z0-9_()]+)(?:\s*\[(.*?)\])?/.exec(S);if(E){const L=E[1].replace(/"/g,""),C=$t(L,E[2],E[3]||"");if(c.has(C.name)){const M=w.indexOf(C.name);M!==-1&&w.splice(M,1)}c.set(C.name,C),w.push(C.name)}}for(const $ of N)O.set($.columns.join("|").toLowerCase(),$);for(const[$,S]of p.entries())A.set($,S);const B=w.map($=>c.get($)).filter(Boolean);B.forEach($=>{$.inlineRef&&t.push(Bt(s,$.name,$.inlineRef.symbol,$.inlineRef.toTable,$.inlineRef.toColumn))});const k=/Note:\s*(['"])([\s\S]*?)\1/i.exec(f);e.push({id:De(s),name:s,fields:B,note:k?k[2]:void 0,color:A.get("color")||void 0,width:A.has("width")?parseInt(A.get("width"),10):void 0,x:A.has("x")?parseInt(A.get("x"),10):void 0,y:A.has("y")?parseInt(A.get("y"),10):void 0,settings:Object.fromEntries(A),indexes:Array.from(O.values())})}return{tables:e,inlineRelationships:t}}class vn{parse(e){const t=dn(e),n=fn(t),{tables:r,inlineRelationships:a}=pn(t),o=mn(t),y=[...a,...o];return{tables:r,relationships:y,projectSettings:n}}}const Rt={Key:`
    <svg viewBox="0 0 24 24" width="100%" height="100%" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
    </svg>`,Table:`
    <svg viewBox="0 0 24 24" width="100%" height="100%" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="3" y1="9" x2="21" y2="9"></line>
        <line x1="9" y1="21" x2="9" y2="9"></line>
    </svg>`};class gn{static create(e,t){const n=document.createElement("div");n.className="db-row",n.id=`col-${t}-${e.name}`,e.isUnique&&n.classList.add("indexed-row");const r=document.createElement("div");r.className="row-left";const a=document.createElement("span");a.className="key-icon",e.isPk||e.isFk?(a.innerHTML=Rt.Key,e.isPk&&e.isFk?(a.classList.add("pk-fk"),a.title="Primary & Foreign Key"):e.isPk?(a.classList.add("pk"),a.title="Primary Key"):(a.classList.add("fk"),a.title="Foreign Key")):a.classList.add("empty"),r.appendChild(a);const o=document.createElement("div");o.className="name-container";const y=document.createElement("span");if(y.className="field-name",y.innerText=e.name,o.appendChild(y),e.note){const p=document.createElement("div");p.className="field-note",p.innerText=e.note,o.appendChild(p)}r.appendChild(o);const s=document.createElement("div");s.className="row-right";const m=document.createElement("div");m.className="type-container";const f=document.createElement("span");if(f.className="field-type",e.isUnique&&f.classList.add("constrained-type"),f.innerText=e.type,m.appendChild(f),e.enumValues&&e.enumValues.length>0){const p=this.createBadge("ENUM","enum");p.title=`Enum values: ${e.enumValues.join(", ")}`,s.appendChild(p)}if(e.isUnique&&s.appendChild(this.createBadge("UQ","unique")),e.isNotNull&&s.appendChild(this.createBadge("NN","not-null")),e.default){const p=document.createElement("div");p.className="field-default",p.innerText=`default: ${e.default}`,m.appendChild(p)}return s.appendChild(m),n.appendChild(r),n.appendChild(s),n}static createBadge(e,t){const n=document.createElement("span");return n.className=`badge ${t}`,n.innerText=e,n}}class yn{static create(e){const t=document.createElement("div");t.className="db-table",t.id=`table-${e.id}`,t.dataset.tableName=e.name,e.width&&(t.style.width=`${e.width}px`);const n=document.createElement("div");n.className="db-table-header",e.color&&(n.style.backgroundColor=e.color);const[r,a]=e.name.includes(".")?e.name.split("."):["",e.name],o=document.createElement("div");o.className="header-title-wrapper";const y=document.createElement("span");y.className="table-icon",y.innerHTML=Rt.Table,o.appendChild(y);const s=document.createElement("span");s.className="title",s.innerText=a,o.appendChild(s),n.appendChild(o);const m=document.createElement("span");if(m.className="schema-banner",m.innerText=r||"public",n.appendChild(m),e.note){const p=document.createElement("div");p.className="table-note",p.innerText=e.note,n.appendChild(p)}t.appendChild(n),e.fields.forEach(p=>{t.appendChild(gn.create(p,e.id))});const f=document.createElement("div");return f.className="resize-handle",f.title="Drag to resize",t.appendChild(f),t}}class xn{static MIN_STRAIGHT=15;static MAX_STRAIGHT=40;static LABEL_OFFSET=25;static calculatePath(e,t,n,r,a,o,y="Curve"){const s=e.y+e.height/2,m=t.y+t.height/2,f={x:e.x+e.width,y:s},p={x:e.x,y:s},b={x:t.x+t.width,y:m},N={x:t.x,y:m},T=e.x<t.x+t.width&&e.x+e.width>t.x;let h,c,w,O;T?(h=f,c=b,w=1,O=1):e.x<t.x?(h=f,c=N,w=1,O=-1):(h=p,c=b,w=-1,O=1);const A=Math.abs(c.x-h.x),B=Math.max(this.MIN_STRAIGHT,Math.min(this.MAX_STRAIGHT,A/3)),k={x:h.x+B*w,y:h.y},$={x:c.x+B*O,y:c.y};if(T){const L=Math.max(40,Math.abs(c.y-h.y)*.4);k.x=Math.max(h.x,c.x)+L,$.x=k.x}let S="";switch(y){case"Rectilinear":case"RoundRectilinear":{const L=(k.x+$.x)/2,C={x:L,y:h.y},M={x:L,y:c.y};if(y==="Rectilinear")S=`M ${h.x} ${h.y} L ${C.x} ${C.y} L ${M.x} ${M.y} L ${c.x} ${c.y}`;else{const v=Math.min(15,Math.abs(M.y-C.y)/2,Math.abs(C.x-h.x)/2),_=c.y>h.y?1:-1,U=C.x>h.x?1:-1,W=c.x>M.x?1:-1;S=`M ${h.x} ${h.y} 
               L ${C.x-v*U} ${C.y} 
               Q ${C.x} ${C.y} ${C.x} ${C.y+v*_} 
               L ${M.x} ${M.y-v*_} 
               Q ${M.x} ${M.y} ${M.x+v*W} ${M.y} 
               L ${c.x} ${c.y}`}break}case"Oblique":case"RoundOblique":{y==="Oblique"?S=`M ${h.x} ${h.y} L ${k.x} ${k.y} L ${$.x} ${$.y} L ${c.x} ${c.y}`:S=`M ${h.x} ${h.y} 
               L ${k.x} ${k.y} 
               Q ${(k.x+$.x)/2} ${(k.y+$.y)/2} ${$.x} ${$.y} 
               L ${c.x} ${c.y}`;break}default:{S=`M ${h.x} ${h.y} C ${k.x} ${k.y}, ${$.x} ${$.y}, ${c.x} ${c.y}`;break}}const x=this.getLabelPos(h,k),E=this.getLabelPos(c,$);return{d:S,start:h,end:c,labelStart:x,labelEnd:E,fromId:n,toId:r,fromTableId:a,toTableId:o}}static getLabelPos(e,t){const n=t.x-e.x,r=t.y-e.y,a=Math.sqrt(n*n+r*r),o=this.LABEL_OFFSET/(a||1);return{x:e.x+n*o,y:e.y+r*o}}}class wn{static createGroup(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","g");n.classList.add("connection-group"),n.dataset.from=e.fromId,n.dataset.to=e.toId,n.dataset.fromTable=e.fromTableId,n.dataset.toTable=e.toTableId;const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",e.d),r.classList.add("relation-hit-area"),n.appendChild(r);const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",e.d),a.classList.add("relation-line-base"),n.appendChild(a);const o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",e.d),o.classList.add("relation-line-flow"),n.appendChild(o),this.createLabels(e,t).forEach(s=>n.appendChild(s)),n}static createLabels(e,t){const n=this.getLabelText(t);return n?[this.createLabelBadge(n.from,e.labelStart.x,e.labelStart.y),this.createLabelBadge(n.to,e.labelEnd.x,e.labelEnd.y)]:[]}static createLabelBadge(e,t,n){const r=document.createElementNS("http://www.w3.org/2000/svg","g");r.classList.add("relation-label-group");const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("x",(t-9).toString()),a.setAttribute("y",(n-7).toString()),a.setAttribute("width","18"),a.setAttribute("height","14"),a.setAttribute("rx","4"),a.classList.add("label-bg");const o=document.createElementNS("http://www.w3.org/2000/svg","text");return o.setAttribute("x",t.toString()),o.setAttribute("y",(n+1).toString()),o.classList.add("relation-label-text"),o.textContent=e,r.appendChild(a),r.appendChild(o),r}static getLabelText(e){switch(e){case"1:n":return{from:"1",to:"n"};case"n:1":return{from:"n",to:"1"};case"1:1":return{from:"1",to:"1"};case"m:n":return{from:"m",to:"n"};default:return null}}}class yt{static create(e){const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttribute("cx",e.x.toString()),t.setAttribute("cy",e.y.toString()),t.setAttribute("r","3.5"),t.classList.add("anchor-port"),t}}class xt{svgLayer;scale=1;container;currentRelationships=[];currentLineStyle="Curve";constructor(e){this.container=e,this.svgLayer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgLayer.classList.add("connection-layer"),e.appendChild(this.svgLayer),this.setupInteractions()}updateScale(e){this.scale=e}setLineStyle(e){this.currentLineStyle=e,this.draw(this.currentRelationships)}draw(e){this.currentRelationships=e,this.svgLayer.innerHTML="",e.forEach(t=>this.drawOne(t))}drawOne(e){const t=`col-${e.fromTable}-${e.fromColumn}`,n=`col-${e.toTable}-${e.toColumn}`,r=document.getElementById(t),a=document.getElementById(n);if(!r||!a)return;const o=this.getRelativeRect(r),y=this.getRelativeRect(a),s=xn.calculatePath(o,y,t,n,`table-${e.fromTable}`,`table-${e.toTable}`,this.currentLineStyle),m=wn.createGroup(s,e.type);this.svgLayer.appendChild(m);const f=yt.create(s.start);f.dataset.anchorId=t,this.svgLayer.appendChild(f);const p=yt.create(s.end);p.dataset.anchorId=n,this.svgLayer.appendChild(p)}getRelativeRect(e){const t=e.getBoundingClientRect(),n=this.svgLayer.getBoundingClientRect();return{x:(t.left-n.left)/this.scale,y:(t.top-n.top)/this.scale,width:t.width/this.scale,height:t.height/this.scale}}setupInteractions(){this.container.addEventListener("mouseover",e=>this.handleHover(e,!0)),this.container.addEventListener("mouseout",e=>this.handleHover(e,!1))}handleHover(e,t){if(!t){this.clearHighlights();return}const n=e.target,r=n.closest(".connection-group");if(r){this.activateConnection(r);return}const a=n.closest(".db-row");if(a&&a.id){this.activateColumn(a.id);return}const o=n.closest(".db-table");if(o&&o.id){this.activateTable(o.id);return}}clearHighlights(){document.querySelectorAll(".highlighted").forEach(t=>t.classList.remove("highlighted"))}activateConnection(e){e.classList.add("highlighted");const t=e.dataset.from,n=e.dataset.to;t&&this.setHighlight(t),n&&this.setHighlight(n),this.highlightAnchorsForLine(t,n)}activateColumn(e){this.setHighlight(e),this.svgLayer.querySelectorAll(`[data-from="${e}"], [data-to="${e}"]`).forEach(n=>{n.classList.add("highlighted");const r=n;r.dataset.from!==e&&this.setHighlight(r.dataset.from),r.dataset.to!==e&&this.setHighlight(r.dataset.to),this.highlightAnchorsForLine(r.dataset.from,r.dataset.to)})}activateTable(e){this.setHighlight(e),this.svgLayer.querySelectorAll(`[data-from-table="${e}"], [data-to-table="${e}"]`).forEach(n=>{n.classList.add("highlighted");const r=n;this.setHighlight(r.dataset.from),this.setHighlight(r.dataset.to),this.highlightAnchorsForLine(r.dataset.from,r.dataset.to)})}setHighlight(e){if(!e)return;const t=document.getElementById(e);t&&t.classList.add("highlighted")}highlightAnchorsForLine(e,t){e&&this.svgLayer.querySelectorAll(`[data-anchor-id="${e}"]`).forEach(r=>r.classList.add("highlighted")),t&&this.svgLayer.querySelectorAll(`[data-anchor-id="${t}"]`).forEach(r=>r.classList.add("highlighted"))}}class bn{activeEl=null;mode="NONE";initialMouse={x:0,y:0};initialVal={x:0,y:0,width:0};scale=1;relationships=[];connectionManager;onUpdate;constructor(e,t,n){this.connectionManager=t,this.onUpdate=n,e.addEventListener("mousedown",r=>this.onMouseDown(r)),window.addEventListener("mousemove",r=>this.onMouseMove(r)),window.addEventListener("mouseup",()=>this.onMouseUp())}updateConnectionManager(e){this.connectionManager=e}setRelationships(e){this.relationships=e}updateScale(e){this.scale=e}onMouseDown(e){const t=e.target;if(t.classList.contains("resize-handle")){const r=t.closest(".db-table");r&&this.startResize(r,e);return}const n=t.closest(".db-table-header");if(n){const r=n.parentElement;r&&this.startDrag(r,e);return}}startDrag(e,t){this.mode="DRAG",this.activeEl=e,this.initialVal.x=e.offsetLeft,this.initialVal.y=e.offsetTop,this.initialMouse={x:t.clientX,y:t.clientY},t.stopPropagation(),t.preventDefault(),e.classList.add("dragging")}startResize(e,t){this.mode="RESIZE",this.activeEl=e,this.initialVal.width=e.offsetWidth,this.initialMouse={x:t.clientX,y:t.clientY},t.stopPropagation(),t.preventDefault(),e.classList.add("resizing"),document.body.style.cursor="col-resize"}onMouseMove(e){if(this.activeEl){if(this.mode==="DRAG"){const t=(e.clientX-this.initialMouse.x)/this.scale,n=(e.clientY-this.initialMouse.y)/this.scale;this.activeEl.style.left=`${this.initialVal.x+t}px`,this.activeEl.style.top=`${this.initialVal.y+n}px`,this.activeEl.style.transform="none",this.connectionManager.draw(this.relationships)}else if(this.mode==="RESIZE"){const t=(e.clientX-this.initialMouse.x)/this.scale,n=Math.max(200,this.initialVal.width+t);this.activeEl.style.width=`${n}px`,this.connectionManager.draw(this.relationships)}}}onMouseUp(){if(!this.activeEl)return;const e=this.activeEl,t=e.querySelector(".title"),n=e.dataset&&e.dataset.tableName||(t?t.textContent||"":e.id.replace("table-",""));if(n){const r=Math.round(parseInt(e.style.left||"0",10)),a=Math.round(parseInt(e.style.top||"0",10)),o=Math.round(e.getBoundingClientRect().width/this.scale);this.onUpdate(n,r,a,o)}e.classList.remove("dragging"),e.classList.remove("resizing"),document.body.style.cursor="",this.activeEl=null,this.mode="NONE"}}function Sn(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var le={exports:{}},wt;function En(){if(wt)return le.exports;wt=1,le.exports=d,le.exports.addWheelListener=d,le.exports.removeWheelListener=e;function d(t,n,r){t.addEventListener("wheel",n,r)}function e(t,n,r){t.removeEventListener("wheel",n,r)}return le.exports}var ue={exports:{}},Re,bt;function Ln(){if(bt)return Re;bt=1;var d=4,e=.001,t=1e-7,n=10,r=11,a=1/(r-1),o=typeof Float32Array=="function";function y(h,c){return 1-3*c+3*h}function s(h,c){return 3*c-6*h}function m(h){return 3*h}function f(h,c,w){return((y(c,w)*h+s(c,w))*h+m(c))*h}function p(h,c,w){return 3*y(c,w)*h*h+2*s(c,w)*h+m(c)}function b(h,c,w,O,A){var B,k,$=0;do k=c+(w-c)/2,B=f(k,O,A)-h,B>0?w=k:c=k;while(Math.abs(B)>t&&++$<n);return k}function N(h,c,w,O){for(var A=0;A<d;++A){var B=p(c,w,O);if(B===0)return c;var k=f(c,w,O)-h;c-=k/B}return c}function T(h){return h}return Re=function(c,w,O,A){if(!(0<=c&&c<=1&&0<=O&&O<=1))throw new Error("bezier x values must be in [0, 1] range");if(c===w&&O===A)return T;for(var B=o?new Float32Array(r):new Array(r),k=0;k<r;++k)B[k]=f(k*a,c,O);function $(S){for(var x=0,E=1,L=r-1;E!==L&&B[E]<=S;++E)x+=a;--E;var C=(S-B[E])/(B[E+1]-B[E]),M=x+C*a,v=p(M,c,O);return v>=e?N(S,M,c,O):v===0?M:b(S,x,x+a,c,O)}return function(x){return x===0?0:x===1?1:f($(x),w,A)}},Re}var St;function Mn(){if(St)return ue.exports;St=1;var d=Ln(),e={ease:d(.25,.1,.25,1),easeIn:d(.42,0,1,1),easeOut:d(0,0,.58,1),easeInOut:d(.42,0,.58,1),linear:d(0,0,1,1)};ue.exports=t,ue.exports.makeAggregateRaf=y,ue.exports.sharedScheduler=y();function t(s,m,f){var p=Object.create(null),b=Object.create(null);f=f||{};var N=typeof f.easing=="function"?f.easing:e[f.easing];N||(f.easing&&console.warn("Unknown easing function in amator: "+f.easing),N=e.ease);var T=typeof f.step=="function"?f.step:n,h=typeof f.done=="function"?f.done:n,c=r(f.scheduler),w=Object.keys(m);w.forEach(function(E){p[E]=s[E],b[E]=m[E]-s[E]});var O=typeof f.duration=="number"?f.duration:400,A=Math.max(1,O*.06),B,k=0;return B=c.next(S),{cancel:$};function $(){c.cancel(B),B=0}function S(){var E=N(k/A);k+=1,x(E),k<=A?(B=c.next(S),T(s)):(B=0,setTimeout(function(){h(s)},0))}function x(E){w.forEach(function(L){s[L]=b[L]*E+p[L]})}}function n(){}function r(s){if(!s){var m=typeof window<"u"&&window.requestAnimationFrame;return m?a():o()}if(typeof s.next!="function")throw new Error("Scheduler is supposed to have next(cb) function");if(typeof s.cancel!="function")throw new Error("Scheduler is supposed to have cancel(handle) function");return s}function a(){return{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}}function o(){return{next:function(s){return setTimeout(s,1e3/60)},cancel:function(s){return clearTimeout(s)}}}function y(){var s=new Set,m=new Set,f=0;return{next:b,cancel:b,clearAll:p};function p(){s.clear(),m.clear(),cancelAnimationFrame(f),f=0}function b(h){m.add(h),N()}function N(){f||(f=requestAnimationFrame(T))}function T(){f=0;var h=m;m=s,s=h,s.forEach(function(c){c()}),s.clear()}}return ue.exports}var Oe,Et;function Tn(){if(Et)return Oe;Et=1;function d(n){t(n);const r=e(n);return n.on=r.on,n.off=r.off,n.fire=r.fire,n}function e(n){let r=Object.create(null);return{on:function(a,o,y){if(typeof o!="function")throw new Error("callback is expected to be a function");let s=r[a];return s||(s=r[a]=[]),s.push({callback:o,ctx:y}),n},off:function(a,o){if(typeof a>"u")return r=Object.create(null),n;if(r[a])if(typeof o!="function")delete r[a];else{const y=r[a];for(let s=0;s<y.length;++s)y[s].callback===o&&y.splice(s,1)}return n},fire:function(a){const o=r[a];if(!o)return n;let y;arguments.length>1&&(y=Array.prototype.slice.call(arguments,1));for(let s=0;s<o.length;++s){const m=o[s];m.callback.apply(m.ctx,y)}return n}}}function t(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");const r=["on","fire","off"];for(let a=0;a<r.length;++a)if(n.hasOwnProperty(r[a]))throw new Error("Subject cannot be eventified, since it already has property '"+r[a]+"'")}return Oe=d,Oe}var ze,Lt;function Cn(){if(Lt)return ze;Lt=1,ze=d;function d(n,r,a){typeof a!="object"&&(a={});var o=typeof a.minVelocity=="number"?a.minVelocity:5,y=typeof a.amplitude=="number"?a.amplitude:.25,s=typeof a.cancelAnimationFrame=="function"?a.cancelAnimationFrame:e(),m=typeof a.requestAnimationFrame=="function"?a.requestAnimationFrame:t(),f,p,b=342,N,T,h,c,w,O,A,B;return{start:$,stop:x,cancel:k};function k(){s(N),s(B)}function $(){f=n(),c=A=T=w=0,p=new Date,s(N),s(B),N=m(S)}function S(){var L=Date.now(),C=L-p;p=L;var M=n(),v=M.x-f.x,_=M.y-f.y;f=M;var U=1e3/(1+C);T=.8*v*U+.2*T,w=.8*_*U+.2*w,N=m(S)}function x(){s(N),s(B);var L=n();h=L.x,O=L.y,p=Date.now(),(T<-o||T>o)&&(c=y*T,h+=c),(w<-o||w>o)&&(A=y*w,O+=A),B=m(E)}function E(){var L=Date.now()-p,C=!1,M=0,v=0;c&&(M=-c*Math.exp(-L/b),M>.5||M<-.5?C=!0:M=c=0),A&&(v=-A*Math.exp(-L/b),v>.5||v<-.5?C=!0:v=A=0),C&&(r(h+M,O+v),B=m(E))}}function e(){return typeof cancelAnimationFrame=="function"?cancelAnimationFrame:clearTimeout}function t(){return typeof requestAnimationFrame=="function"?requestAnimationFrame:function(n){return setTimeout(n,16)}}return ze}var Ie,Mt;function Nn(){if(Mt)return Ie;Mt=1,Ie=d;function d(n){if(n)return{capture:t,release:t};var r,a,o,y=!1;return{capture:s,release:m};function s(f){y=!0,a=window.document.onselectstart,o=window.document.ondragstart,window.document.onselectstart=e,r=f,r.ondragstart=e}function m(){y&&(y=!1,window.document.onselectstart=a,r&&(r.ondragstart=o))}}function e(n){return n.stopPropagation(),!1}function t(){}return Ie}var Pe,Tt;function An(){if(Tt)return Pe;Tt=1,Pe=d;function d(){this.x=0,this.y=0,this.scale=1}return Pe}var xe={exports:{}},Ct;function kn(){if(Ct)return xe.exports;Ct=1,xe.exports=d,xe.exports.canAttach=e;function d(t,n){if(!e(t))throw new Error("svg element is required for svg.panzoom to work");var r=t.ownerSVGElement;if(!r)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");n.disableKeyboardInteraction||r.setAttribute("tabindex",0);var a={getBBox:y,getScreenCTM:s,getOwner:o,applyTransform:f,initTransform:m};return a;function o(){return r}function y(){var p=t.getBBox();return{left:p.x,top:p.y,width:p.width,height:p.height}}function s(){var p=r.getCTM();return p||r.getScreenCTM()}function m(p){var b=t.getCTM();b===null&&(b=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),p.x=b.e,p.y=b.f,p.scale=b.a,r.removeAttributeNS(null,"viewBox")}function f(p){t.setAttribute("transform","matrix("+p.scale+" 0 0 "+p.scale+" "+p.x+" "+p.y+")")}}function e(t){return t&&t.ownerSVGElement&&t.getCTM}return xe.exports}var we={exports:{}},Nt;function $n(){if(Nt)return we.exports;Nt=1,we.exports=d,we.exports.canAttach=e;function d(t,n){var r=e(t);if(!r)throw new Error("panzoom requires DOM element to be attached to the DOM tree");var a=t.parentElement;t.scrollTop=0,n.disableKeyboardInteraction||a.setAttribute("tabindex",0);var o={getBBox:s,getOwner:y,applyTransform:m};return o;function y(){return a}function s(){return{left:0,top:0,width:t.clientWidth,height:t.clientHeight}}function m(f){t.style.transformOrigin="0 0 0",t.style.transform="matrix("+f.scale+", 0, 0, "+f.scale+", "+f.x+", "+f.y+")"}}function e(t){return t&&t.parentElement&&t.style}return we.exports}var qe,At;function Bn(){if(At)return qe;At=1;var d=En(),e=Mn(),t=Tn(),n=Cn(),r=Nn(),a=r(),o=r(!0),y=An(),s=kn(),m=$n(),f=1,p=1.75,b=300,N=200;qe=T;function T(S,x){x=x||{};var E=x.controller;if(E||(s.canAttach(S)?E=s(S,x):m.canAttach(S)&&(E=m(S,x))),!E)throw new Error("Cannot create panzoom for the current type of dom element");var L=E.getOwner(),C={x:0,y:0},M=!1,v=new y;E.initTransform&&E.initTransform(v);var _=typeof x.filterKey=="function"?x.filterKey:w,U=typeof x.pinchSpeed=="number"?x.pinchSpeed:1,W=x.bounds,P=typeof x.maxZoom=="number"?x.maxZoom:Number.POSITIVE_INFINITY,D=typeof x.minZoom=="number"?x.minZoom:0,F=typeof x.boundsPadding=="number"?x.boundsPadding:.05,Z=typeof x.zoomDoubleClickSpeed=="number"?x.zoomDoubleClickSpeed:p,be=x.beforeWheel||w,te=x.beforeMouseDown||w,Se=typeof x.zoomSpeed=="number"?x.zoomSpeed:f,Y=h(x.transformOrigin),Ee=x.enableTextSelection?o:a;O(W),x.autocenter&&qt();var ne,je=0,Ve=0,re=0,He=null,_e=new Date,Le,ie=!1,ae=!1,j,V,Me,Te,Ce,H;"smoothScroll"in x&&!x.smoothScroll?H=k():H=n(Gt,Jt,x.smoothScroll);var Ne,oe,de,fe=!1;Qe();var he={dispose:en,moveBy:Q,moveTo:Ae,smoothMoveTo:Qt,centerOn:Kt,zoomTo:ge,zoomAbs:me,smoothZoom:ve,smoothZoomAbs:cn,showRectangle:Pt,pause:Ot,resume:zt,isPaused:It,getTransform:Dt,getMinZoom:Ft,setMinZoom:Zt,getMaxZoom:jt,setMaxZoom:Vt,getTransformOrigin:Ht,setTransformOrigin:_t,getZoomSpeed:Wt,setZoomSpeed:Yt};t(he);var We=typeof x.initialX=="number"?x.initialX:v.x,Ye=typeof x.initialY=="number"?x.initialY:v.y,Ge=typeof x.initialZoom=="number"?x.initialZoom:v.scale;return(We!=v.x||Ye!=v.y||Ge!=v.scale)&&me(We,Ye,Ge),he;function Ot(){Je(),fe=!0}function zt(){fe&&(Qe(),fe=!1)}function It(){return fe}function Pt(i){var l=L.getBoundingClientRect(),u=X(l.width,l.height),g=i.right-i.left,R=i.bottom-i.top;if(!Number.isFinite(g)||!Number.isFinite(R))throw new Error("Invalid rectangle");var z=u.x/g,I=u.y/R,q=Math.min(z,I);v.x=-(i.left+g/2)*q+u.x/2,v.y=-(i.top+R/2)*q+u.y/2,v.scale=q}function X(i,l){if(E.getScreenCTM){var u=E.getScreenCTM(),g=u.a,R=u.d,z=u.e,I=u.f;C.x=i*g-z,C.y=l*R-I}else C.x=i,C.y=l;return C}function qt(){var i,l,u=0,g=0,R=Xe();if(R)u=R.left,g=R.top,i=R.right-R.left,l=R.bottom-R.top;else{var z=L.getBoundingClientRect();i=z.width,l=z.height}var I=E.getBBox();if(!(I.width===0||I.height===0)){var q=l/I.height,ee=i/I.width,K=Math.min(ee,q);v.x=-(I.left+I.width/2)*K+i/2+u,v.y=-(I.top+I.height/2)*K+l/2+g,v.scale=K}}function Dt(){return v}function Ft(){return D}function Zt(i){D=i}function jt(){return P}function Vt(i){P=i}function Ht(){return Y}function _t(i){Y=h(i)}function Wt(){return Se}function Yt(i){if(!Number.isFinite(i))throw new Error("Zoom speed should be a number");Se=i}function Gt(){return{x:v.x,y:v.y}}function Ae(i,l){v.x=i,v.y=l,ke(),J("pan"),$e()}function Ue(i,l){Ae(v.x+i,v.y+l)}function ke(){var i=Xe();if(i){var l=!1,u=Ut(),g=i.left-u.right;return g>0&&(v.x+=g,l=!0),g=i.right-u.left,g<0&&(v.x+=g,l=!0),g=i.top-u.bottom,g>0&&(v.y+=g,l=!0),g=i.bottom-u.top,g<0&&(v.y+=g,l=!0),l}}function Xe(){if(W){if(typeof W=="boolean"){var i=L.getBoundingClientRect(),l=i.width,u=i.height;return{left:l*F,top:u*F,right:l*(1-F),bottom:u*(1-F)}}return W}}function Ut(){var i=E.getBBox(),l=Xt(i.left,i.top);return{left:l.x,top:l.y,right:i.width*v.scale+l.x,bottom:i.height*v.scale+l.y}}function Xt(i,l){return{x:i*v.scale+v.x,y:l*v.scale+v.y}}function $e(){M=!0,ne=window.requestAnimationFrame(tn)}function Ke(i,l,u){if(B(i)||B(l)||B(u))throw new Error("zoom requires valid numbers");var g=v.scale*u;if(g<D){if(v.scale===D)return;u=D/v.scale}if(g>P){if(v.scale===P)return;u=P/v.scale}var R=X(i,l);if(v.x=R.x-u*(R.x-v.x),v.y=R.y-u*(R.y-v.y),W&&F===1&&D===1)v.scale*=u,ke();else{var z=ke();z||(v.scale*=u)}J("zoom"),$e()}function me(i,l,u){var g=u/v.scale;Ke(i,l,g)}function Kt(i){var l=i.ownerSVGElement;if(!l)throw new Error("ui element is required to be within the scene");var u=i.getBoundingClientRect(),g=u.left+u.width/2,R=u.top+u.height/2,z=l.getBoundingClientRect(),I=z.width/2-g,q=z.height/2-R;Q(I,q,!0)}function Qt(i,l){Q(i-v.x,l-v.y,!0)}function Q(i,l,u){if(!u)return Ue(i,l);Ne&&Ne.cancel();var g={x:0,y:0},R={x:i,y:l},z=0,I=0;Ne=e(g,R,{step:function(q){Ue(q.x-z,q.y-I),z=q.x,I=q.y}})}function Jt(i,l){ye(),Ae(i,l)}function en(){Je()}function Qe(){L.addEventListener("mousedown",st,{passive:!1}),L.addEventListener("dblclick",ot,{passive:!1}),L.addEventListener("touchstart",tt,{passive:!1}),L.addEventListener("keydown",et,{passive:!1}),d.addWheelListener(L,ft,{passive:!1}),$e()}function Je(){d.removeWheelListener(L,ft),L.removeEventListener("mousedown",st),L.removeEventListener("keydown",et),L.removeEventListener("dblclick",ot),L.removeEventListener("touchstart",tt),ne&&(window.cancelAnimationFrame(ne),ne=0),H.cancel(),ut(),dt(),Ee.release(),Be()}function tn(){M&&nn()}function nn(){M=!1,E.applyTransform(v),J("transform"),ne=0}function et(i){var l=0,u=0,g=0;if(i.keyCode===38?u=1:i.keyCode===40?u=-1:i.keyCode===37?l=1:i.keyCode===39?l=-1:i.keyCode===189||i.keyCode===109?g=1:(i.keyCode===187||i.keyCode===107)&&(g=-1),!_(i,l,u,g)){if(l||u){i.preventDefault(),i.stopPropagation();var R=L.getBoundingClientRect(),z=Math.min(R.width,R.height),I=.05,q=z*I*l,ee=z*I*u;Q(q,ee)}if(g){var K=ht(g*100),z=Y?ce():rn();ge(z.x,z.y,K)}}}function rn(){var i=L.getBoundingClientRect();return{x:i.width/2,y:i.height/2}}function tt(i){if(an(i),se(),i.touches.length===1)return sn(i,i.touches[0]);i.touches.length===2&&(Ce=at(i.touches[0],i.touches[1]),de=!0,nt())}function an(i){x.onTouch&&!x.onTouch(i)||(i.stopPropagation(),i.preventDefault())}function on(i){se(),!(x.onDoubleClick&&!x.onDoubleClick(i))&&(i.preventDefault(),i.stopPropagation())}function sn(i){Ve=new Date;var l=i.touches[0],u=G(l);Le=u;var g=X(u.x,u.y);j=g.x,V=g.y,Me=j,Te=V,H.cancel(),nt()}function nt(){ie||(ie=!0,document.addEventListener("touchmove",rt),document.addEventListener("touchend",pe),document.addEventListener("touchcancel",pe))}function rt(i){if(i.touches.length===1){i.stopPropagation();var l=i.touches[0],u=G(l),g=X(u.x,u.y),R=g.x-j,z=g.y-V;R!==0&&z!==0&&mt(),j=g.x,V=g.y,Q(R,z)}else if(i.touches.length===2){de=!0;var I=i.touches[0],q=i.touches[1],ee=at(I,q),K=1+(ee/Ce-1)*U,pt=G(I),vt=G(q);if(j=(pt.x+vt.x)/2,V=(pt.y+vt.y)/2,Y){var u=ce();j=u.x,V=u.y}ge(j,V,K),Ce=ee,i.stopPropagation(),i.preventDefault()}}function se(){re&&(clearTimeout(re),re=0)}function it(i){if(x.onClick){se();var l=j-Me,u=V-Te,g=Math.sqrt(l*l+u*u);g>5||(re=setTimeout(function(){re=0,x.onClick(i)},b))}}function pe(i){if(se(),i.touches.length>0){var l=G(i.touches[0]),u=X(l.x,l.y);j=u.x,V=u.y}else{var g=new Date;if(g-je<b)if(Y){var l=ce();ve(l.x,l.y,Z)}else ve(Le.x,Le.y,Z);else g-Ve<N&&it(i);je=g,Be(),dt()}}function at(i,l){var u=i.clientX-l.clientX,g=i.clientY-l.clientY;return Math.sqrt(u*u+g*g)}function ot(i){on(i);var l=G(i);Y&&(l=ce()),ve(l.x,l.y,Z)}function st(i){if(se(),!te(i)){if(He=i,_e=new Date,ie)return i.stopPropagation(),!1;var l=i.button===1&&window.event!==null||i.button===0;if(l){H.cancel();var u=G(i),g=X(u.x,u.y);return Me=j=g.x,Te=V=g.y,document.addEventListener("mousemove",ct),document.addEventListener("mouseup",lt),Ee.capture(i.target||i.srcElement),!1}}}function ct(i){if(!ie){mt();var l=G(i),u=X(l.x,l.y),g=u.x-j,R=u.y-V;j=u.x,V=u.y,Q(g,R)}}function lt(){var i=new Date;i-_e<N&&it(He),Ee.release(),Be(),ut()}function ut(){document.removeEventListener("mousemove",ct),document.removeEventListener("mouseup",lt),ae=!1}function dt(){document.removeEventListener("touchmove",rt),document.removeEventListener("touchend",pe),document.removeEventListener("touchcancel",pe),ae=!1,de=!1,ie=!1}function ft(i){if(!be(i)){H.cancel();var l=i.deltaY;i.deltaMode>0&&(l*=100);var u=ht(l);if(u!==1){var g=Y?ce():G(i);ge(g.x,g.y,u),i.preventDefault()}}}function G(i){var l,u,g=L.getBoundingClientRect();return l=i.clientX-g.left,u=i.clientY-g.top,{x:l,y:u}}function ve(i,l,u){var g=v.scale,R={scale:g},z={scale:u*g};H.cancel(),ye(),oe=e(R,z,{step:function(I){me(i,l,I.scale)},done:ln})}function cn(i,l,u){var g=v.scale,R={scale:g},z={scale:u};H.cancel(),ye(),oe=e(R,z,{step:function(I){me(i,l,I.scale)}})}function ce(){var i=L.getBoundingClientRect();return{x:i.width*Y.x,y:i.height*Y.y}}function ge(i,l,u){return H.cancel(),ye(),Ke(i,l,u)}function ye(){oe&&(oe.cancel(),oe=null)}function ht(i){var l=Math.sign(i),u=Math.min(.25,Math.abs(Se*i/128));return 1-l*u}function mt(){ae||(J("panstart"),ae=!0,H.start())}function Be(){ae&&(de||H.stop(),J("panend"))}function ln(){J("zoomend")}function J(i){he.fire(i,he)}}function h(S){if(S){if(typeof S=="object")return(!A(S.x)||!A(S.y))&&c(S),S;c()}}function c(S){throw console.error(S),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join(`
`))}function w(){}function O(S){var x=typeof S;if(!(x==="undefined"||x==="boolean")){var E=A(S.left)&&A(S.top)&&A(S.bottom)&&A(S.right);if(!E)throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}}function A(S){return Number.isFinite(S)}function B(S){return Number.isNaN?Number.isNaN(S):S!==S}function k(){return{start:w,stop:w,cancel:w}}function $(){if(typeof document>"u")return;var S=document.getElementsByTagName("script");if(!S)return;for(var x,E=0;E<S.length;++E){var L=S[E];if(L.src&&L.src.match(/\bpanzoom(\.min)?\.js/)){x=L;break}}if(!x)return;var C=x.getAttribute("query");if(!C)return;var M=x.getAttribute("name")||"pz",v=Date.now();_();function _(){var P=document.querySelector(C);if(!P){var D=Date.now(),F=D-v;if(F<2e3){setTimeout(_,100);return}console.error("Cannot find the panzoom element",M);return}var Z=U(x);console.log(Z),window[M]=T(P,Z)}function U(P){for(var D=P.attributes,F={},Z=0;Z<D.length;++Z){var be=D[Z],te=W(be);te&&(F[te.name]=te.value)}return F}function W(P){if(P.name){var D=P.name[0]==="p"&&P.name[1]==="z"&&P.name[2]==="-";if(D){var F=P.name.substr(3),Z=JSON.parse(P.value);return{name:F,value:Z}}}}}return $(),qe}var Rn=Bn();const On=Sn(Rn);class zn{pz;currentScale=1;currentX=0;currentY=0;constructor(e,t,n){this.pz=On(e,{maxZoom:3,minZoom:.2,bounds:!1,beforeMouseDown:a=>a.target.closest(".db-table")!==null});const r=a=>{const o=a.getTransform();this.currentScale=o.scale,this.currentX=o.x||0,this.currentY=o.y||0,t(this.currentScale),n&&n(this.currentScale,this.currentX,this.currentY)};this.pz.on("zoom",r),this.pz.on("pan",r),this.pz.on("transform",r),this.resetView()}getScale(){return this.currentScale}getTransform(){return{scale:this.currentScale,x:this.currentX,y:this.currentY}}setTransform(e,t,n){this.pz.zoomAbs(0,0,1),this.pz.moveTo(t,n),this.pz.zoomAbs(0,0,e),this.currentScale=e,this.currentX=t,this.currentY=n}zoomIn(){const e=window.innerWidth/2,t=window.innerHeight/2;this.pz.smoothZoom(e,t,1.25)}zoomOut(){const e=window.innerWidth/2,t=window.innerHeight/2;this.pz.smoothZoom(e,t,.8)}resetView(){const e=window.innerWidth/2,t=window.innerHeight/2;this.pz.moveTo(e,t),this.pz.zoomAbs(0,0,1),this.currentX=e,this.currentY=t,this.currentScale=1}dispose(){this.pz.dispose()}}class kt{el;container;constructor(e,t,n){this.container=e,this.el=document.createElement("div"),this.el.className="schema-hud";const r=document.createElement("div");r.className="hud-group";const a=this.createButton("▓","Toggle Grid"),o=e.classList.contains("grid-visible");a.dataset.state=o?"on":"off",o&&a.classList.add("active"),a.onclick=()=>{const w=!(a.dataset.state==="on");a.dataset.state=w?"on":"off",a.classList.toggle("active",w),w?this.container.classList.add("grid-visible"):this.container.classList.remove("grid-visible"),this.dispatchProjectSettingsChange({showGrid:w})},r.appendChild(a);const y=document.createElement("div");y.className="hud-group";const s=[{value:"Curve",text:"Curve"},{value:"Rectilinear",text:"Rectilinear"},{value:"RoundRectilinear",text:"Round Rectilinear"},{value:"Oblique",text:"Oblique"},{value:"RoundOblique",text:"Round Oblique"}],m=document.createElement("div");m.className="custom-select";const f=document.createElement("div");f.className="select-trigger",f.innerText="Curve",f.title="Connection Line Style";const p=document.createElement("div");p.className="select-options",f.onclick=c=>{c.stopPropagation(),m.classList.toggle("open")},window.addEventListener("click",c=>{m.contains(c.target)||m.classList.remove("open")}),s.forEach(c=>{const w=document.createElement("div");w.className="select-option",w.innerText=c.text,w.onclick=()=>{f.innerText=c.text,m.querySelectorAll(".select-option").forEach(O=>O.classList.remove("selected")),w.classList.add("selected"),m.classList.remove("open"),n.setLineStyle(c.value),this.dispatchProjectSettingsChange({lineStyle:c.value})},c.value==="Curve"&&w.classList.add("selected"),p.appendChild(w)}),m.appendChild(f),m.appendChild(p),y.appendChild(m);const b=document.createElement("div");b.className="hud-group";const N=this.createButton("+","Zoom In");N.onclick=()=>t.zoomIn();const T=this.createButton("−","Zoom Out");T.onclick=()=>t.zoomOut();const h=this.createButton("⌂","Reset View");h.onclick=()=>t.resetView(),b.append(T,h,N),this.el.append(r,y,b),e.appendChild(this.el)}createButton(e,t){const n=document.createElement("button");return n.className="hud-btn",n.innerText=e,n.title=t,n}dispatchProjectSettingsChange(e){const t=new CustomEvent("project-settings-changed",{detail:e});this.container.dispatchEvent(t)}}class In{container;wrapper;connectionManager;dragManager;panZoomManager;hud;parsers={dbml:new vn};constructor(e,t,n){this.container=document.getElementById(e),this.wrapper=document.createElement("div"),this.wrapper.className="schema-wrapper",this.container.appendChild(this.wrapper),this.connectionManager=new xt(this.wrapper),this.dragManager=new bn(this.wrapper,this.connectionManager,t),this.panZoomManager=new zn(this.wrapper,r=>{this.dragManager.updateScale(r),this.connectionManager.updateScale(r),this.container.style.setProperty("--zoom",r.toString())},(r,a,o)=>{this.dragManager.updateScale(r),this.connectionManager.updateScale(r),this.container.style.setProperty("--zoom",r.toString()),this.container.style.setProperty("--pan-x",`${a}px`),this.container.style.setProperty("--pan-y",`${o}px`),n&&n(r,a,o)}),this.hud=new kt(this.container,this.panZoomManager,this.connectionManager)}render(e,t){this.wrapper.innerHTML="",this.connectionManager=new xt(this.wrapper),this.dragManager.updateConnectionManager(this.connectionManager);const n=this.panZoomManager.getTransform();if(this.connectionManager.updateScale(n.scale),this.dragManager.updateScale(n.scale),this.container.querySelector(".schema-hud")?.remove(),this.hud=new kt(this.container,this.panZoomManager,this.connectionManager),this.container.style.setProperty("--zoom",n.scale.toString()),this.container.style.setProperty("--pan-x",`${n.x}px`),this.container.style.setProperty("--pan-y",`${n.y}px`),!!t.trim())try{let r=(e||"").toLowerCase().trim();r.startsWith(".")&&(r=r.slice(1));const a=this.parsers[r];if(!a)throw new Error(`Unsupported format: ${e}`);const{tables:o,relationships:y,projectSettings:s}=a.parse(t);if(s){if(s.zoom!==void 0||s.panX!==void 0){const T=s.zoom||1,h=s.panX||0,c=s.panY||0;this.panZoomManager.setTransform(T,h,c),this.container.style.setProperty("--zoom",T.toString()),this.container.style.setProperty("--pan-x",`${h}px`),this.container.style.setProperty("--pan-y",`${c}px`)}const b=s.showGrid==="true"||s.showGrid===!0;b?this.container.classList.add("grid-visible"):this.container.classList.remove("grid-visible");const N=this.container.querySelector('.hud-btn[title="Toggle Grid"]');if(N&&(N.dataset.state=b?"on":"off",b?N.classList.add("active"):N.classList.remove("active")),s.lineStyle){this.connectionManager.setLineStyle(s.lineStyle);const T=this.container.querySelector(".select-trigger"),h=this.container.querySelectorAll(".select-option");T&&h.length&&(T.textContent=s.lineStyle,h.forEach(c=>{c.textContent===s.lineStyle?c.classList.add("selected"):c.classList.remove("selected")}))}}const m=350,f=300,p=3;o.forEach((b,N)=>{const T=yn.create(b);this.wrapper.appendChild(T);let h=b.x!==void 0?b.x:50+N%p*m,c=b.y!==void 0?b.y:50+Math.floor(N/p)*f;if(T.style.left=`${h}px`,T.style.top=`${c}px`,b.width&&(T.style.width=`${b.width}px`),b.color){const w=T.querySelector(".db-table-header");w&&(w.style.backgroundColor=b.color)}}),this.dragManager.setRelationships(y),setTimeout(()=>{this.connectionManager.draw(y)},0)}catch(r){console.error(r),this.wrapper.innerHTML=`<div class="error" style="padding:20px; color:red;">Error: ${r.message}</div>`}}}const Ze=new un(d=>{switch(d.type){case"UPDATE_CONTENT":Pn.render(d.format,d.content);break;case"UPDATE_THEME":Dn(d.theme);break}}),Pn=new In("app",(d,e,t,n)=>{Ze.send({type:"UPDATE_TABLE_POS",tableName:d,x:e,y:t,width:n})}),qn=document.getElementById("app");qn.addEventListener("project-settings-changed",d=>{const e=d.detail||{};Ze.send({type:"UPDATE_PROJECT_SETTINGS",settings:{lineStyle:e.lineStyle,showGrid:e.showGrid}})});function Dn(d){d==="dark"?document.body.classList.add("dark"):document.body.classList.remove("dark")}Ze.log("Webview Initialized & Ready");</script>
  <style rel="stylesheet" crossorigin>.db-table{position:absolute;top:0;left:0;min-width:200px;width:auto;background:var(--table-bg);border:1px solid var(--table-border);border-radius:8px;box-shadow:0 4px 6px #0000001a;z-index:1;display:flex;flex-direction:column}.db-table.dragging,.db-table.resizing{box-shadow:0 10px 15px #0003;z-index:100}.db-table.dragging{cursor:grabbing}.db-table.resizing{cursor:col-resize}.db-table-header{background:var(--header-bg);color:var(--header-text);padding:10px;font-weight:700;border-top-left-radius:7px;border-top-right-radius:7px;cursor:grab;display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:8px}.db-table-header:active{cursor:grabbing}.header-title-wrapper{display:flex;align-items:center;gap:6px}.table-icon{width:16px;height:16px;display:flex;opacity:.9}.table-icon svg{width:100%;height:100%;stroke-width:2.5px}.title{font-size:15px;line-height:1.2}.schema-banner{background:#fff3;padding:2px 6px;border-radius:4px;font-size:12px}.table-note{font-size:11px;color:#fffc;margin-top:4px;width:100%;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.resize-handle{position:absolute;top:0;right:0;width:12px;height:100%;cursor:col-resize;z-index:50;background:transparent;border-right:4px solid rgba(0,0,0,.1);transition:all .2s;border-top-right-radius:8px;border-bottom-right-radius:8px}.resize-handle:hover,.db-table.resizing .resize-handle{background-color:#3b82f61a;border-right:4px solid var(--header-bg)}body.dark .resize-handle{border-right:4px solid rgba(255,255,255,.1)}body.dark .resize-handle:hover{border-right:4px solid var(--header-bg)}.db-row{display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid var(--table-border);font-size:13px;line-height:1.4;position:relative;transition:background-color .15s ease}.db-row:hover{background-color:#7d7d7d0d}.db-row:last-child{border-bottom:none;border-bottom-left-radius:8px;border-bottom-right-radius:8px}.indexed-row{background:linear-gradient(to right,rgba(var(--header-rgb),.08),transparent)}.row-left{display:flex;align-items:flex-start;gap:8px;flex:1;min-width:0;padding-right:8px}.key-icon{width:12px;height:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px}.key-icon svg{width:100%;height:100%}.key-icon.pk{color:#eab308}.key-icon.fk{color:#3b82f6}.key-icon.pk-fk{color:#22c55e}.key-icon.empty{width:16px}.name-container{display:flex;flex-direction:column;overflow:hidden}.field-name{font-weight:600;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.field-note{font-size:11px;color:var(--text-secondary);margin-top:2px;line-height:1.2;font-style:italic;opacity:.8}.row-right{display:flex;align-items:flex-start;justify-content:flex-end;gap:6px;flex-shrink:0}.type-container{display:flex;flex-direction:column;align-items:flex-end}.field-type{color:var(--text-secondary);font-size:11px;font-family:SF Mono,Monaco,Menlo,Courier New,monospace;text-align:right;background:#9696961a;padding:1px 4px;border-radius:4px}.constrained-type{text-decoration-color:var(--header-bg);text-decoration-thickness:2px}.field-default{font-size:10px;color:var(--text-secondary);opacity:.7;text-align:right;margin-top:2px;max-width:100px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.badge{font-size:9px;height:16px;padding:0 6px;display:flex;align-items:center;justify-content:center;border-radius:10px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;box-shadow:0 1px 2px #0000000d}.badge.unique{background:#f3e8ff;color:#7e22ce;border:1px solid rgba(126,34,206,.1)}.badge.not-null{background:#f3f4f6;color:#4b5563;border:1px solid rgba(75,85,99,.1)}.badge.enum{background:#ecfdf5;color:#047857;border:1px solid rgba(4,120,87,.1)}body.dark .db-row:hover{background-color:#ffffff0d}body.dark .field-type{background:#ffffff14;color:#a1a1aa}body.dark .badge.unique{background:#3b0764;color:#d8b4fe;border-color:#581c87}body.dark .badge.not-null{background:#374151;color:#e5e7eb;border-color:#4b5563}body.dark .badge.enum{background:#064e3b;color:#6ee7b7;border-color:#065f46}@keyframes flashHighlight{0%{box-shadow:inset 3px 0 0 var(--header-bg),0 0 #0000}50%{box-shadow:inset 3px 0 0 var(--header-bg),0 0 12px rgba(var(--header-rgb),.4)}to{box-shadow:inset 3px 0 0 var(--header-bg),0 0 #0000}}.db-row.highlighted{background-color:rgba(var(--header-rgb),.1);color:var(--text-primary);animation:flashHighlight 1.5s infinite;z-index:10}.db-table.highlighted{border-color:var(--header-bg);animation:flashTable 1.5s infinite;z-index:20}@keyframes flashTable{0%{box-shadow:0 4px 6px #0000001a}50%{box-shadow:0 0 15px rgba(var(--header-rgb),.6)}to{box-shadow:0 4px 6px #0000001a}}.connection-layer{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;overflow:visible}.connection-group{pointer-events:auto;cursor:pointer}.relation-hit-area{fill:none;stroke:transparent;stroke-width:20px}.relation-line-base{fill:none;stroke:var(--line-color);stroke-width:2px;stroke-linecap:round;transition:stroke .3s,stroke-width .3s}.relation-line-flow{fill:none;stroke:var(--header-bg);stroke-width:2px;stroke-linecap:round;stroke-dasharray:15 150;opacity:.4;animation:flowAnimation 5s linear infinite}@keyframes flowAnimation{to{stroke-dashoffset:-165}}@keyframes continuousFlow{to{stroke-dashoffset:-24}}.connection-group.highlighted .relation-line-base{stroke:var(--header-bg);stroke-width:3px;opacity:.5}.connection-group.highlighted .relation-line-flow{opacity:1;stroke-width:3px;stroke-dasharray:12 12;animation:continuousFlow .8s linear infinite;filter:drop-shadow(0 0 4px var(--header-bg))}.anchor-port{fill:var(--bg-color);stroke:var(--line-color);stroke-width:2px;transition:all .3s}.anchor-port.highlighted{stroke:var(--header-bg);fill:var(--header-bg);r:5px;filter:drop-shadow(0 0 3px var(--header-bg))}.label-bg{fill:var(--bg-color);stroke:var(--table-border);transition:all .3s}.connection-group.highlighted .label-bg{stroke:var(--header-bg);fill:#fff}.relation-label-text{font-size:10px;font-weight:700;fill:var(--text-secondary);text-anchor:middle;dominant-baseline:middle;pointer-events:none}.connection-group.highlighted .relation-label-text{fill:var(--header-bg)}.schema-hud{position:absolute;bottom:20px;left:20px;right:auto;background:var(--table-bg);border:1px solid var(--table-border);border-radius:8px;box-shadow:0 4px 12px #00000026;display:flex;flex-direction:row;align-items:center;padding:6px 12px;gap:12px;z-index:1000;-webkit-user-select:none;user-select:none}.hud-group{display:flex;gap:6px;align-items:center}.hud-group+.hud-group{border-top:none;margin-top:0;border-left:1px solid var(--table-border);padding-left:12px;margin-left:0}.hud-btn{background:transparent;border:1px solid transparent;color:var(--text-primary);border-radius:4px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;cursor:pointer;transition:all .12s}.hud-btn:hover,.hud-btn.active{background:rgba(var(--header-rgb),.1);color:var(--header-bg)}.custom-select{position:relative;font-size:12px;min-width:120px}.select-trigger{background:var(--bg-color);color:var(--text-primary);border:1px solid var(--table-border);border-radius:4px;padding:4px 24px 4px 8px;cursor:pointer;white-space:nowrap;position:relative;height:28px;display:flex;align-items:center}.select-trigger:after{content:"▲";font-size:8px;position:absolute;right:8px;top:50%;transform:translateY(-50%);opacity:.6}.select-options{display:none;position:absolute;bottom:100%;left:0;margin-bottom:8px;background:var(--table-bg);border:1px solid var(--table-border);border-radius:6px;box-shadow:0 -4px 12px #00000026;width:100%;min-width:140px;overflow:hidden;z-index:1001;flex-direction:column}.custom-select.open .select-options{display:flex}.select-option{padding:8px 12px;cursor:pointer;color:var(--text-primary);transition:background .1s}.select-option:hover{background:rgba(var(--header-rgb),.1);color:var(--header-bg)}.select-option.selected{font-weight:700;background:rgba(var(--header-rgb),.05);color:var(--header-bg)}:root{--bg-color: #f4f4f4;--table-bg: #ffffff;--table-border: #d1d5db;--header-bg: #3b82f6;--header-rgb: 59, 130, 246;--header-text: #ffffff;--text-primary: #1f2937;--text-secondary: #6b7280;--line-color: #9ca3af;--grid-line: rgba(0, 0, 0, .04);--axis-line: rgba(0, 0, 0, .08)}body.dark{--bg-color: #1e1e1e;--table-bg: #2b2d30;--table-border: #4e5256;--header-bg: #3574f0;--header-rgb: 53, 116, 240;--header-text: #ffffff;--text-primary: #d1d5db;--text-secondary: #9ca3af;--line-color: #6b7280;--grid-line: rgba(255, 255, 255, .04);--axis-line: rgba(255, 255, 255, .08)}body{margin:0;background:var(--bg-color);color:var(--text-primary);font-family:sans-serif;overflow:hidden}#app{width:100vw;height:100vh;overflow:hidden;position:relative;--zoom: 1;--pan-x: 0px;--pan-y: 0px}#app.grid-visible{background-image:linear-gradient(to right,var(--axis-line) 2px,transparent 2px),linear-gradient(to bottom,var(--axis-line) 2px,transparent 2px),linear-gradient(to right,var(--grid-line) 1px,transparent 1px),linear-gradient(to bottom,var(--grid-line) 1px,transparent 1px);background-repeat:no-repeat,no-repeat,repeat,repeat;background-position:var(--pan-x) 0,0 var(--pan-y),var(--pan-x) var(--pan-y),var(--pan-x) var(--pan-y);background-size:2px 100%,100% 2px,calc(20px * var(--zoom)) calc(20px * var(--zoom)),calc(20px * var(--zoom)) calc(20px * var(--zoom))}.schema-wrapper{width:100%;height:100%;transform-origin:0 0;position:relative}</style>
</head>

<body>
<div id="app"></div>
</body>

</html>
